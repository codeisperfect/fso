function pincode_using_geocoder(e,t){var a=new google.maps.LatLng(e,t);geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:a},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[0]){for(address=e[0].address_components,p=address.length-1;p>=0;p--)if(-1!=address[p].types.indexOf("postal_code")){var a=address[p].long_name;document.getElementById("start_pincode").value=a}}else alert("Geocoder failed due to: "+t)})}function check_pincode(e){for(address=e.address_components,p=address.length-1;p>=0;p--)if(-1!=address[p].types.indexOf("postal_code")){var t=address[p].long_name;return void(document.getElementById("start_pincode").value=t)}pincode_using_geocoder(e.geometry.location.lat(),e.geometry.location.lng())}function initialize_map(e){var t={zoom:11,center:home_location};map=new google.maps.Map(document.getElementById("map-canvas"),t);var a={map:map,polylineOptions:{strokeOpacity:1,strokeColor:"#1E90FF",strokeWeight:5}};directionsDisplay=new google.maps.DirectionsRenderer(a),stepDisplay=new google.maps.InfoWindow,"confirm-order"==e&&CalcRoute()}function getDriversForRegion(e,t){var a={};""!=e&&(a.geo_region_id=e),$.ajax({url:"/administrators/get_driver_for_region",method:"GET",data:a,dataType:"json",success:function(e){t(e)}})}


function getDefaultBoundsForRegion(e,t){
	var a={geo_region_id:e};




//$.ajax({url:"https://survey.theporter.in/get_default_bounds_for_region",method:"GET",data:a,dataType:"json",success:function(e){t(e)}})

t(dbound[e]);

}function changeMapCenter(e,t){

	var a={};
	""!=e&&(a.geo_region_id=e);


// $.ajax({url:"/get_map_center_region",method:"GET",data:a,dataType:"json",success:function(e){
// 	var a=new google.maps.LatLng(e.center_lat,e.center_long);map.panTo(a),map.setZoom(11),"function"==typeof t&&t(e)}
// })


var timepass112 =function(e){
	var a=new google.maps.LatLng(e.center_lat,e.center_long);map.panTo(a),map.setZoom(11),"function"==typeof t&&t(e)
}
timepass112(map_center[e]);


}
function changeBoundsForGoogleMapAutoComplete(e){$("#"+e).change(function(){"undefined"!=typeof document.getElementById(e).value&&getDefaultBoundsForRegion(document.getElementById(e).value,function(e){var t=new google.maps.LatLngBounds(new google.maps.LatLng(e.default_bounds.min_lat,e.default_bounds.min_long),new google.maps.LatLng(e.default_bounds.max_lat,e.default_bounds.max_long));for(i=0;i<addMapsAutoCompleteListener.autocomplete_element.length;++i)addMapsAutoCompleteListener.autocomplete_element[i].setBounds(t)})})}function addMapsAutoCompleteListener(elementName,functionName,callback_val){var geo_region_id=1,geo_region_elem=document.getElementById("order_geo_region_id");null!=geo_region_elem&&""!=geo_region_elem.value&&(geo_region_id=geo_region_elem.value),getDefaultBoundsForRegion(geo_region_id,function(data){var defaultBounds=new google.maps.LatLngBounds(new google.maps.LatLng(data.default_bounds.min_lat,data.default_bounds.min_long),new google.maps.LatLng(data.default_bounds.max_lat,data.default_bounds.max_long)),element=document.getElementById(elementName),options={bounds:defaultBounds,countryomponentRestrictions:{country:"in"}};with(addMapsAutoCompleteListener.autocomplete_element.push(new google.maps.places.Autocomplete(element,options)),{autocomplete_element:addMapsAutoCompleteListener.autocomplete_element[addMapsAutoCompleteListener.autocomplete_element.length-1]})google.maps.event.addListener(autocomplete_element,"place_changed",function(){"undefined"==typeof callback_val?functionName(autocomplete_element):functionName(callback_val,autocomplete_element)})})}function Haversine(e,t,a,r){var s=6371,n=a-e,o=toRad(n),i=r-t,l=toRad(i),d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(toRad(e))*Math.cos(toRad(a))*Math.sin(l/2)*Math.sin(l/2),_=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),c=s*_;return console.log(c),c}function toRad(e){return e*Math.PI/180}function Validator(e){this.formobj=document.forms[e],this.formobj&&(this.formobj.onsubmit?(this.formobj.old_onsubmit=this.formobj.onsubmit,this.formobj.onsubmit=null):this.formobj.old_onsubmit=null,this.formobj._sfm_form_name=e,this.formobj.onsubmit=form_submit_handler,this.addValidation=add_validation,this.setAddnlValidationFunction=set_addnl_vfunction,this.clearAllValidations=clear_all_validations,this.disable_validations=!1,document.error_disp_handler=new sfm_ErrorDisplayHandler,this.EnableOnPageErrorDisplay=validator_enable_OPED,this.EnableOnPageErrorDisplaySingleBox=validator_enable_OPED_SB,this.show_errors_together=!0,this.EnableMsgsTogether=sfm_enable_show_msgs_together)}function ValidatorUpdated(e){return this.formobj=document.forms.namedItem(e),this.formobj?(this.formobj.onsubmit?(this.formobj.old_onsubmit=this.formobj.onsubmit,this.formobj.onsubmit=null):this.formobj.old_onsubmit=null,this.formobj._sfm_form_name=e,this.formobj.onsubmit=form_submit_handler,this.addValidation=add_validation,this.setAddnlValidationFunction=set_addnl_vfunction,this.clearAllValidations=clear_all_validations,this.disable_validations=!1,document.error_disp_handler=new sfm_ErrorDisplayHandler,this.EnableOnPageErrorDisplay=validator_enable_OPED,this.EnableOnPageErrorDisplaySingleBox=validator_enable_OPED_SB,this.show_errors_together=!0,void(this.EnableMsgsTogether=sfm_enable_show_msgs_together)):void console.log("Error: couldnot get Form object "+e)}function set_addnl_vfunction(e){this.formobj.addnlvalidation=e}function sfm_enable_show_msgs_together(){this.show_errors_together=!0,this.formobj.show_errors_together=!0}function clear_all_validations(){for(var e=0;e<this.formobj.elements.length;e++)this.formobj.elements[e].validationset=null}function form_submit_handler(){var bRet=!0;document.error_disp_handler.clear_msgs();for(var itr=0;itr<this.elements.length&&(this.elements[itr].validationset&&!this.elements[itr].validationset.validate()&&(bRet=!1),bRet||this.show_errors_together);itr++);return bRet?this.addnlvalidation&&(str=" var ret = "+this.addnlvalidation+"()",eval(str),!ret)?(document.error_disp_handler.FinalShowMsg(),ret):!0:(document.error_disp_handler.FinalShowMsg(),!1)}function add_validation(e,t,a){var r=null;if(arguments.length>3&&(r=arguments[3]),this.formobj){var s=this.formobj[e];s.length&&isNaN(s.selectedIndex)&&(s=s[0]),s&&(s.validationset||(s.validationset=new ValidationSet(s,this.show_errors_together)),s.validationset.add(t,a,r),s.validatorobj=this)}}function validator_enable_OPED(){document.error_disp_handler.EnableOnPageDisplay(!1)}function validator_enable_OPED_SB(){document.error_disp_handler.EnableOnPageDisplay(!0)}function sfm_ErrorDisplayHandler(){this.msgdisplay=new AlertMsgDisplayer,this.EnableOnPageDisplay=edh_EnableOnPageDisplay,this.ShowMsg=edh_ShowMsg,this.FinalShowMsg=edh_FinalShowMsg,this.all_msgs=new Array,this.clear_msgs=edh_clear_msgs}function edh_clear_msgs(){this.msgdisplay.clearmsg(this.all_msgs),this.all_msgs=new Array}function edh_FinalShowMsg(){this.msgdisplay.showmsg(this.all_msgs)}function edh_EnableOnPageDisplay(e){this.msgdisplay=1==e?new SingleBoxErrorDisplay:new DivMsgDisplayer}function edh_ShowMsg(e,t){var a=new Array;a.input_element=t,a.msg=e,this.all_msgs.push(a)}function AlertMsgDisplayer(){this.showmsg=alert_showmsg,this.clearmsg=alert_clearmsg}function alert_clearmsg(){}function alert_showmsg(e){var t="",a=null;for(var r in e)null==a&&(a=e[r].input_element),t+=e[r].msg+"\n";alert(t),null!=a&&a.focus()}function sfm_show_error_msg(e,t){document.error_disp_handler.ShowMsg(e,t)}function SingleBoxErrorDisplay(){this.showmsg=sb_div_showmsg,this.clearmsg=sb_div_clearmsg}function sb_div_clearmsg(e){var t=form_error_div_name(e);show_div_msg(t,"")}function sb_div_showmsg(e){var t="<ul>\n";for(var a in e)t+="<li>"+e[a].msg+"</li>\n";t+="</ul>";var r=form_error_div_name(e);show_div_msg(r,t)}function form_error_div_name(e){var t=null;for(var a in e)if(t=e[a].input_element)break;var r="";return t&&(r=t.form._sfm_form_name+"_errorloc"),r}function DivMsgDisplayer(){this.showmsg=div_showmsg,this.clearmsg=div_clearmsg}function div_clearmsg(e){for(var t in e){var a=element_div_name(e[t].input_element);show_div_msg(a,"")}}function element_div_name(e){var t=e.form._sfm_form_name+"_"+e.id+"_errorloc";return t=t.replace(/[\[\]]/gi,"")}function div_showmsg(e){var t=null;for(var a in e){null==t&&(t=e[a].input_element);var r=element_div_name(e[a].input_element);show_div_msg(r,e[a].msg)}null!=t&&t.focus()}function show_div_msg(e,t){if(e.length<=0)return!1;if(document.layers){if(divlayer=document.layers[e],!divlayer)return;divlayer.document.open(),divlayer.document.write(t),divlayer.document.close()}else if(document.all){if(divlayer=document.all[e],!divlayer)return;divlayer.innerHTML=t}else if(document.getElementById){if(divlayer=document.getElementById(e),!divlayer)return;divlayer.innerHTML=t}return divlayer.style.visibility="visible",!1}function ValidationDesc(e,t,a,r){this.desc=t,this.error=a,this.itemobj=e,this.condition=r,this.validate=vdesc_validate}function vdesc_validate(){return null==this.condition||eval(this.condition)?validateInput(this.desc,this.itemobj,this.error)?!0:(this.itemobj.validatorobj.disable_validations=!0,this.itemobj.focus(),!1):!0}function ValidationSet(e,t){this.vSet=new Array,this.add=add_validationdesc,this.validate=vset_validate,this.itemobj=e,this.msgs_together=t}function add_validationdesc(e,t,a){this.vSet[this.vSet.length]=new ValidationDesc(this.itemobj,e,t,a)}function vset_validate(){for(var e=!0,t=0;t<this.vSet.length&&(e=e&&this.vSet[t].validate(),e||this.msgs_together);t++);return e}function validateEmail(e){var t=e.match("^(.+)@(.+)$");if(null==t)return!1;if(null!=t[1]){var a=/^\"?[\w-_\.]*\"?$/;if(null==t[1].match(a))return!1}if(null!=t[2]){var r=/^[\w-\.]*\.[A-Za-z]{2,4}$/;if(null==t[2].match(r)){var s=/^\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\]$/;if(null==t[2].match(s))return!1}return!0}return!1}function IsCheckSelected(e,t){var a=!1,r=e.form.elements[e.name];if(r.length){for(var s=-1,n=0;n<r.length;n++)if(r[n].value==t){s=n;break}s>=0&&"1"==r[s].checked&&(a=!0)}else"1"==e.checked&&(a=!0);return a}function TestDontSelectChk(e,t,a){var r=!0;return r=IsCheckSelected(e,t)?!1:!0,0==r&&(a&&0!=a.length||(a="Can't Proceed as you selected "+e.name),sfm_show_error_msg(a,e)),r}function TestShouldSelectChk(e,t,a){var r=!0;return r=IsCheckSelected(e,t)?!0:!1,0==r&&(a&&0!=a.length||(a="You should select"+e.name),sfm_show_error_msg(a,e)),r}function TestRequiredInput(objValue,strError){var ret=!0;return 0==eval(objValue.value.length)&&(strError&&0!=strError.length||(strError=objValue.name+" : Required Field"),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestMaxLen(objValue,strMaxLen,strError){var ret=!0;return eval(objValue.value.length)>eval(strMaxLen)&&(strError&&0!=strError.length||(strError=objValue.name+" : "+strMaxLen+" characters maximum "),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestMinLen(objValue,strMinLen,strError){var ret=!0;return eval(objValue.value.length)<eval(strMinLen)&&(strError&&0!=strError.length||(strError=objValue.name+" : "+strMinLen+" characters minimum  "),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestInputType(e,t,a,r){var s=!0,n=e.value.search(t);return e.value.length>0&&n>=0&&(a&&0!=a.length||(a=r),sfm_show_error_msg(a,e),s=!1),s}function TestEmail(e,t){var a=!0;return e.value.length>0&&!validateEmail(e.value)&&(t&&0!=t.length||(t=e.name+": Enter a valid Email address "),sfm_show_error_msg(t,e),a=!1),a}function TestLessThan(objValue,strLessThan,strError){var ret=!0;return isNaN(objValue.value)?(sfm_show_error_msg(objValue.name+": Should be a number ",objValue),ret=!1):eval(objValue.value)>=eval(strLessThan)&&(strError&&0!=strError.length||(strError=objValue.name+" : value should be less than "+strLessThan),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestGreaterThan(objValue,strGreaterThan,strError){var ret=!0;return isNaN(objValue.value)?(sfm_show_error_msg(objValue.name+": Should be a number ",objValue),ret=!1):eval(objValue.value)<=eval(strGreaterThan)&&(strError&&0!=strError.length||(strError=objValue.name+" : value should be greater than "+strGreaterThan),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestRegExp(e,t,a){var r=!0;return e.value.length>0&&!e.value.match(t)&&(a&&0!=a.length||(a=e.name+": Invalid characters found "),sfm_show_error_msg(a,e),r=!1),r}function TestDontSelect(e,t,a){var r=!0;return null==e.value?(sfm_show_error_msg("Error: dontselect command for non-select Item",e),r=!1):e.value==t&&(a&&0!=a.length||(a=e.name+": Please Select one option "),sfm_show_error_msg(a,e),r=!1),r}function TestSelectOneRadio(e,t){for(var a=e.form.elements[e.name],r=!1,s=0;s<a.length;s++)if("1"==a[s].checked){r=!0;break}return"1"==a.checked&&(r=!0),0==r&&(t&&0!=t.length||(t="Please select one option from "+e.name),sfm_show_error_msg(t,e)),r}function TestSelectMinChk(e,t){for(var a=e.form.elements[e.name],r=!1,s=0;s<a.length;s++)if("1"==a[s].checked){r=!0;break}return 0==r&&(t&&0!=t.length||(t="Please select one option from "+e.name),sfm_show_error_msg(t,e)),r}function TestFileExtension(e,t,a){var r=!1,s=!1;if(e.value.length<=0)return!0;for(var n=t.split(";"),o=0;o<n.length;o++)if(ext=e.value.substr(e.value.length-n[o].length,n[o].length),ext=ext.toLowerCase(),ext==n[o]){s=!0;break}return s?r=!0:(a&&0!=a.length||(a=e.name+" allowed file extensions are: "+t),sfm_show_error_msg(a,e),r=!1),r}function validateInput(e,t,a){var r=!0,s=e.search("="),n="",o="";switch(s>=0?(n=e.substring(0,s),o=e.substr(s+1)):n=e,n){case"req":case"required":r=TestRequiredInput(t,a);break;case"maxlength":case"maxlen":r=TestMaxLen(t,o,a);break;case"minlength":case"minlen":r=TestMinLen(t,o,a);break;case"alnum":case"alphanumeric":r=TestInputType(t,"[^A-Za-z0-9]",a,t.name+": Only alpha-numeric characters allowed ");break;case"alnum_s":case"alphanumeric_space":r=TestInputType(t,"[^A-Za-z0-9\\s]",a,t.name+": Only alpha-numeric characters and space allowed ");break;case"num":case"numeric":r=TestInputType(t,"[^0-9]",a,t.name+": Only digits allowed ");break;case"alphabetic":case"alpha":r=TestInputType(t,"[^A-Za-z]",a,t.name+": Only alphabetic characters allowed ");break;case"alphabetic_space":case"alpha_s":r=TestInputType(t,"[^A-Za-z\\s]",a,t.name+": Only alphabetic characters and space allowed ");break;case"email":r=TestEmail(t,a);break;case"lt":case"lessthan":r=TestLessThan(t,o,a);break;case"gt":case"greaterthan":r=TestGreaterThan(t,o,a);break;case"regexp":r=TestRegExp(t,o,a);break;case"dontselect":r=TestDontSelect(t,o,a);break;case"dontselectchk":r=TestDontSelectChk(t,o,a);break;case"shouldselchk":r=TestShouldSelectChk(t,o,a);break;case"selone_radio":r=TestSelectOneRadio(t,a);break;case"selmin":r=TestSelectMinChk(t,a);break;case"file_extn":r=TestFileExtension(t,o,a)}return r}function VWZ_IsListItemSelected(e,t){for(var a=0;a<e.options.length;a++)if(1==e.options[a].selected&&e.options[a].value==t)return!0;return!1}function VWZ_IsChecked(e,t){if(e.length){for(var a=0;a<e.length;a++)if("1"==e[a].checked&&e[a].value==t)return!0}else if("1"==e.checked)return!0;return!1}function DoCustomValidation(e){if(!e)return!1;if(!e.from_address_lat.value&&!e.from_address_long.value)return sfm_show_error_msg("Invalid Landmark!",e.from_address_landmark),!1;if(!e.to_address_lat.value&&!e.to_address_long.value)return sfm_show_error_msg("Invalid Landmark!",e.to_address_landmark),!1;if(0==e.waypoint_count.value&&!(e.to_address_lat.value-e.from_address_lat.value&&e.to_address_long.value-e.from_address_long.value))return sfm_show_error_msg("From and To Landmark are the same!",e.to_address_landmark),sfm_show_error_msg("From and To Landmark are the same!",e.from_address_landmark),!1;if(!(e.from_address_lat.value>e.geo_min_lat.value&&e.from_address_long.value>e.geo_min_lng.value&&e.from_address_lat.value<e.geo_max_lat.value&&e.from_address_long.value<e.geo_max_lng.value))return sfm_show_error_msg("From landmark doesn not lie within the selected geo region id. Please select the appropriate city",e.from_address_landmark),!1;var t=new Date(e.datetimepicker.value);return t.getTime()<Date.now()?(sfm_show_error_msg("Please note that the pick up time cannot be in the past",e.datetimepicker),!1):!0}function runValidation(e){var t=new ValidateForm(e);t.formobj?t.EnableOnPageErrorDisplay():alert("Could not run validation on the submitted form.")}function trim11(e){e=e.replace(/^\s+/,"");for(var t=e.length-1;t>=0;t--)if(/\S/.test(e.charAt(t))){e=e.substring(0,t+1);break}return e}function ValidateForm(e){this.formobj=document.forms[e],this.formobj&&(this.formobj.onsubmit?(this.formobj.old_onsubmit=this.formobj.onsubmit,this.formobj.onsubmit=null):this.formobj.old_onsubmit=null,this.formobj._sfm_form_name=e,this.formobj.onsubmit=form_submit_handler,this.addValidation=add_validation,this.setAddnlValidationFunction=set_addnl_vfunction,this.clearAllValidations=clear_all_validations,this.disable_validations=!1,document.error_disp_handler=new sfm_ErrorDisplayHandler,this.EnableOnPageErrorDisplay=validator_enable_OPED,this.EnableOnPageErrorDisplaySingleBox=validator_enable_OPED_SB,this.show_errors_together=!0,this.EnableMsgsTogether=sfm_enable_show_msgs_together,this.processForm())}function process_element_for_validations(e){var t=[],a=[];if(e.attributes&&e.attributes.getNamedItem("validation_required"))for(var r=e.attributes.getNamedItem("validation_required").value.split(","),s=0;s<r.length;++s){var n=r[s];-1==n.indexOf("-")?(t.push(trim11(n)),a.push(error_code(e.placeholder,t[t.length-1]))):(t.push(trim11(n.split(/-(.+)?/)[0])),a.push(trim11(n.split(/-(.+)?/)[1])))}return[t,a]}function error_code(e,t){var a="undefined",r=t.search("="),s="",n="";switch(r>=0?(s=t.substring(0,r),n=t.substr(r+1)):s=t,s){case"req":case"required":a="This is a required field";break;case"maxlength":case"maxlen":a="Maximum number of digits reached",a=e+" : "+n+" characters maximum ";break;case"minlength":case"minlen":a="Minimum number of characters not reached";break;case"alnum":case"alphanumeric":a="This field can only contain alphabets or numbers";break;case"alnum_s":case"alphanumeric_space":a="This field can only contain alphabets, numbers or space";break;case"num":case"numeric":a="This field can only contain numbers";break;case"alphabetic":case"alpha":a="This field can only contain alphabets";break;case"alphabetic_space":case"alpha_s":a="This field can only contain alphabets or spaces";break;case"email":a="Enter a valid Email address ";break;case"lt":case"lessthan":a="The value should be less than "+n;break;case"gt":case"greaterthan":a="The value should be greater than "+n;break;case"regexp":a="Invalid characters found ";break;case"dontselect":a="Can't Proceed based on your selection ";break;case"dontselectchk":a="Please select from one of the given options";break;case"shouldselchk":a="You should select one of the given options";break;case"selone_radio":a="Please select one option ";break;case"selmin":a="Please select one option";break;case"file_extn":a="File extension is not allowed";break;case"tick_checkbox":a="Please tick the checkbox"}return a}function set_addnl_vfunction(e){this.formobj.addnlvalidation=e}function sfm_enable_show_msgs_together(){this.show_errors_together=!0,this.formobj.show_errors_together=!0}function clear_all_validations(){for(var e=0;e<this.formobj.elements.length;e++)this.formobj.elements[e].validationset=null}function form_submit_handler(){var bRet=!0;document.error_disp_handler.clear_msgs();for(var itr=0;itr<this.elements.length&&(this.elements[itr].validationset&&!this.elements[itr].validationset.validate()&&(bRet=!1),bRet||this.show_errors_together);itr++);return bRet?this.addnlvalidation&&(str=" var ret = "+this.addnlvalidation+"()",eval(str),!ret)?(document.error_disp_handler.FinalShowMsg(),ret):!0:(document.error_disp_handler.FinalShowMsg(),!1)}function add_validation(e,t,a,r){var s=null;if(arguments.length>4&&(s=arguments[4]),r){var n=r[e];if(n.length&&isNaN(n.selectedIndex)&&(n=n[0]),!n)return void alert("Error: Couldnot get the input object named: "+e);n.validationset||(n.validationset=new ValidationSet(n,this.show_errors_together)),n.validationset.add(t,a,s),n.validatorobj=this}}function validator_enable_OPED(){document.error_disp_handler.EnableOnPageDisplay(!1)}function validator_enable_OPED_SB(){document.error_disp_handler.EnableOnPageDisplay(!0)}function sfm_ErrorDisplayHandler(){this.msgdisplay=new AlertMsgDisplayer,this.EnableOnPageDisplay=edh_EnableOnPageDisplay,this.ShowMsg=edh_ShowMsg,this.FinalShowMsg=edh_FinalShowMsg,this.all_msgs=new Array,this.clear_msgs=edh_clear_msgs}function edh_clear_msgs(){this.msgdisplay.clearmsg(this.all_msgs),this.all_msgs=new Array}function edh_FinalShowMsg(){this.msgdisplay.showmsg(this.all_msgs)}function edh_EnableOnPageDisplay(e){this.msgdisplay=1==e?new SingleBoxErrorDisplay:new DivMsgDisplayer}function edh_ShowMsg(e,t){var a=new Array;a.input_element=t,a.msg=e,this.all_msgs.push(a)}function AlertMsgDisplayer(){this.showmsg=alert_showmsg,this.clearmsg=alert_clearmsg}function alert_clearmsg(){}function alert_showmsg(e){var t="",a=null;for(var r in e)null==a&&(a=e[r].input_element),t+=e[r].msg+"\n";alert(t),null!=a&&a.focus()}function sfm_show_error_msg(e,t){document.error_disp_handler.ShowMsg(e,t)}function SingleBoxErrorDisplay(){this.showmsg=sb_div_showmsg,this.clearmsg=sb_div_clearmsg}function sb_div_clearmsg(e){var t=form_error_div_name(e);show_div_msg(t,"")}function sb_div_showmsg(e){var t="<ul>\n";for(var a in e)t+="<li>"+e[a].msg+"</li>\n";t+="</ul>";var r=form_error_div_name(e);show_div_msg(r,t)}function form_error_div_name(e){var t=null;for(var a in e)if(t=e[a].input_element)break;var r="";return t&&(r=t.form._sfm_form_name+"_errorloc"),r}function DivMsgDisplayer(){this.showmsg=div_showmsg,this.clearmsg=div_clearmsg}function div_clearmsg(e){for(var t in e){var a=element_div_name(e[t].input_element);show_div_msg(a,"")}}function element_div_name(e){var t=e.form._sfm_form_name+"_"+e.id+"_errorloc";return t=t.replace(/[\[\]]/gi,"")}function div_showmsg(e){var t=null;for(var a in e){null==t&&(t=e[a].input_element);var r=element_div_name(e[a].input_element);show_div_msg(r,e[a].msg)}null!=t&&t.focus()}function show_div_msg(e,t){if(e.length<=0)return!1;if(document.layers){if(divlayer=document.layers[e],!divlayer)return;divlayer.document.open(),divlayer.document.write(t),divlayer.document.close()}else if(document.all){if(divlayer=document.all[e],!divlayer)return;divlayer.innerHTML=t}else if(document.getElementById){if(divlayer=document.getElementById(e),!divlayer)return;divlayer.innerHTML=t}return divlayer.style.visibility="visible",!1}function ValidationDesc(e,t,a,r){this.desc=t,this.error=a,this.itemobj=e,this.condition=r,this.validate=vdesc_validate}function vdesc_validate(){return null==this.condition||eval(this.condition)?validateInput(this.desc,this.itemobj,this.error)?!0:(this.itemobj.validatorobj.disable_validations=!0,this.itemobj.focus(),!1):!0}function ValidationSet(e,t){this.vSet=new Array,this.add=add_validationdesc,this.validate=vset_validate,this.itemobj=e,this.msgs_together=t}function add_validationdesc(e,t,a){this.vSet[this.vSet.length]=new ValidationDesc(this.itemobj,e,t,a)}function vset_validate(){for(var e=!0,t=0;t<this.vSet.length&&(e=e&&this.vSet[t].validate(),e||this.msgs_together);t++);return e}function validateEmail(e){var t=e.match("^(.+)@(.+)$");if(null==t)return!1;if(null!=t[1]){var a=/^\"?[\w-_\.]*\"?$/;if(null==t[1].match(a))return!1}if(null!=t[2]){var r=/^[\w-\.]*\.[A-Za-z]{2,4}$/;if(null==t[2].match(r)){var s=/^\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\]$/;if(null==t[2].match(s))return!1}return!0}return!1}function IsCheckSelected(e,t){var a=!1,r=e.form.elements[e.name];if(r.length){for(var s=-1,n=0;n<r.length;n++)if(r[n].value==t){s=n;break}s>=0&&"1"==r[s].checked&&(a=!0)}else"1"==e.checked&&(a=!0);return a}function TestDontSelectChk(e,t,a){var r=!0;return r=IsCheckSelected(e,t)?!1:!0,0==r&&(a&&0!=a.length||(a="Can't Proceed as you selected "+e.name),sfm_show_error_msg(a,e)),r}function TestShouldSelectChk(e,t,a){var r=!0;return r=IsCheckSelected(e,t)?!0:!1,0==r&&(a&&0!=a.length||(a="You should select"+e.name),sfm_show_error_msg(a,e)),r}function TestRequiredInput(objValue,strError){var ret=!0;return 0==eval(objValue.value.length)&&(strError&&0!=strError.length||(strError=objValue.name+" : Required Field"),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestMaxLen(objValue,strMaxLen,strError){var ret=!0;return eval(objValue.value.length)>eval(strMaxLen)&&(strError&&0!=strError.length||(strError=objValue.name+" : "+strMaxLen+" characters maximum "),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestMinLen(objValue,strMinLen,strError){var ret=!0;return eval(objValue.value.length)<eval(strMinLen)&&(strError&&0!=strError.length||(strError=objValue.name+" : "+strMinLen+" characters minimum  "),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestInputType(e,t,a,r){var s=!0,n=e.value.search(t);return e.value.length>0&&n>=0&&(a&&0!=a.length||(a=r),sfm_show_error_msg(a,e),s=!1),s}function TestEmail(e,t){var a=!0;return e.value.length>0&&!validateEmail(e.value)&&(t&&0!=t.length||(t=e.name+": Enter a valid Email address "),sfm_show_error_msg(t,e),a=!1),a}function TestLessThan(objValue,strLessThan,strError){var ret=!0;return isNaN(objValue.value)?(sfm_show_error_msg(objValue.name+": Should be a number ",objValue),ret=!1):eval(objValue.value)>=eval(strLessThan)&&(strError&&0!=strError.length||(strError=objValue.name+" : value should be less than "+strLessThan),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestGreaterThan(objValue,strGreaterThan,strError){var ret=!0;return isNaN(objValue.value)?(sfm_show_error_msg(objValue.name+": Should be a number ",objValue),ret=!1):eval(objValue.value)<=eval(strGreaterThan)&&(strError&&0!=strError.length||(strError=objValue.name+" : value should be greater than "+strGreaterThan),sfm_show_error_msg(strError,objValue),ret=!1),ret}function TestRegExp(e,t,a){var r=!0;return e.value.length>0&&!e.value.match(t)&&(a&&0!=a.length||(a=e.name+": Invalid characters found "),sfm_show_error_msg(a,e),r=!1),r}function TestDontSelect(e,t,a){var r=!0;return null==e.value?(sfm_show_error_msg("Error: dontselect command for non-select Item",e),r=!1):e.value==t&&(a&&0!=a.length||(a=e.name+": Please Select one option "),sfm_show_error_msg(a,e),r=!1),r}function TestSelectOneRadio(e,t){for(var a=e.form.elements[e.name],r=!1,s=0;s<a.length;s++)if("1"==a[s].checked){r=!0;break}return"1"==a.checked&&(r=!0),0==r&&(t&&0!=t.length||(t="Please select one option from "+e.name),sfm_show_error_msg(t,e)),r}function TestSelectMinChk(e,t){for(var a=e.form.elements[e.name],r=!1,s=0;s<a.length;s++)if("1"==a[s].checked){r=!0;break}return 0==r&&(t&&0!=t.length||(t="Please select one option from "+e.name),sfm_show_error_msg(t,e)),r}function TestCheckBox(e,t){var a=e.form.elements[e.name],r=a.checked;return t&&0!=t.length||(t="Please tick the checkbox: "+e.name),r||sfm_show_error_msg(t,e),r}function TestFileExtension(e,t,a){var r=!1,s=!1;if(e.value.length<=0)return!0;for(var n=t.split(";"),o=0;o<n.length;o++)if(ext=e.value.substr(e.value.length-n[o].length,n[o].length),ext=ext.toLowerCase(),ext==n[o]){s=!0;break}return s?r=!0:(a&&0!=a.length||(a=e.name+" allowed file extensions are: "+t),sfm_show_error_msg(a,e),r=!1),r}function validateInput(e,t,a){var r=!0,s=e.search("="),n="",o="";switch(s>=0?(n=e.substring(0,s),o=e.substr(s+1)):n=e,n){case"req":case"required":r=TestRequiredInput(t,a);break;case"maxlength":case"maxlen":r=TestMaxLen(t,o,a);break;case"minlength":case"minlen":r=TestMinLen(t,o,a);break;case"alnum":case"alphanumeric":r=TestInputType(t,"[^A-Za-z0-9]",a,t.name+": Only alpha-numeric characters allowed ");break;case"alnum_s":case"alphanumeric_space":r=TestInputType(t,"[^A-Za-z0-9\\s]",a,t.name+": Only alpha-numeric characters and space allowed ");break;case"num":case"numeric":r=TestInputType(t,"[^0-9]",a,t.name+": Only digits allowed ");break;case"alphabetic":case"alpha":r=TestInputType(t,"[^A-Za-z]",a,t.name+": Only alphabetic characters allowed ");break;case"alphabetic_space":case"alpha_s":r=TestInputType(t,"[^A-Za-z\\s]",a,t.name+": Only alphabetic characters and space allowed ");break;case"email":r=TestEmail(t,a);break;case"lt":case"lessthan":r=TestLessThan(t,o,a);break;case"gt":case"greaterthan":r=TestGreaterThan(t,o,a);break;case"regexp":r=TestRegExp(t,o,a);break;case"dontselect":r=TestDontSelect(t,o,a);break;case"dontselectchk":r=TestDontSelectChk(t,o,a);break;case"shouldselchk":r=TestShouldSelectChk(t,o,a);break;case"selone_radio":r=TestSelectOneRadio(t,a);break;case"selmin":r=TestSelectMinChk(t,a);break;case"file_extn":r=TestFileExtension(t,o,a);break;case"tick_checkbox":r=TestCheckBox(t,o,a)}return r}function VWZ_IsListItemSelected(e,t){for(var a=0;a<e.options.length;a++)if(1==e.options[a].selected&&e.options[a].value==t)return!0;return!1}function VWZ_IsChecked(e,t){if(e.length){for(var a=0;a<e.length;a++)if("1"==e[a].checked&&e[a].value==t)return!0}else if("1"==e.checked)return!0;return!1}function place_order(){document.getElementById("confirm_btn").style.display="none",document.getElementById("wait_msg").style.display="block";var e=document.getElementById("customer_mobile").value,t=document.getElementById("datetimepicker").value,a=document.getElementById("vehicle_type_request_id").value,r=document.getElementById("from_address_landmark").value,s=document.getElementById("from_address_lat").value,n=document.getElementById("from_address_long").value,o=document.getElementById("to_address_landmark").value,i=document.getElementById("to_address_lat").value,l=document.getElementById("to_address_long").value,

d=document.getElementById("estimated_distance").value,_=document.getElementById("estimated_fare").value;getDataPlaceOrder("submit_order.php?customer_mobile="+e+"&datetimepicker="+t+"&from_address_landmark="+r+"&from_address_lat="+s+"&from_address_long="+n+"&to_address_landmark="+o+"&to_address_lat="+i+"&to_address_long="+l+"&estimated_distance="+d+"&estimated_fare="+_+"&vehicle_type_request_id="+a)}function timedRedirect(e){var t="../place_order_thank_you.php?order_id=",a=e,r=t.concat(a);setTimeout(function(){window.location.href=r},1e3)}function getDataPlaceOrder(e){XMLHttpRequestObject&&(XMLHttpRequestObject.open("GET",e),XMLHttpRequestObject.onreadystatechange=function(){if(4==XMLHttpRequestObject.readyState&&200==XMLHttpRequestObject.status){document.getElementById("wait_msg").style.display="none";var e=XMLHttpRequestObject.responseText,t=e.split(",",2),a=t[1],r=document.getElementById("order_result");r.innerHTML=t[0],timedRedirect(a)}else(3==XMLHttpRequestObject.readyState||2==XMLHttpRequestObject.readyState)&&(document.getElementById("confirm_btn").style.display="none",document.getElementById("wait_msg").style.display="block")},XMLHttpRequestObject.send(null))}function CalcRoute(){if($.rails.disableFormElements($($.rails.formSubmitSelector)),null!=document.getElementById("from_address_lat")){var e=document.getElementById("from_address_lat").value,t=document.getElementById("from_address_long").value,a=document.getElementById("to_address_lat").value,r=document.getElementById("to_address_long").value,s=(document.getElementById("datetimepicker").value,e+", "+t),n=a+", "+r,o=[];for(i=1;i<waypts.length;i++)o.push({location:waypts[i],stopover:!0});calcRoute(s,n,o)}}function use_route(e,t,a,r,s,n,o){for(var i=[],l=0,d=0,_=[],c=0;c<e.legs.length;c++){l+=e.legs[c].distance.value/1e3,d+=e.legs[c].duration.value/60;var m=[];m.push(e.legs[c].steps[0].duration.value);for(var u=1;u<e.legs[c].steps.length;++u)m.push(m[u-1]+e.legs[c].steps[u].duration.value);last_duration_value=0;for(var u=0;u<e.legs[c].steps.length;u+=Math.ceil(e.legs[c].steps.length/(8/e.legs.length)))_.push([e.legs[c].steps[u].start_location.lat(),e.legs[c].steps[u].start_location.lng()]),i.push(m[u]-last_duration_value),last_duration_value=m[u]}r&&_.unshift([parseFloat(t.split(",")[0]),parseFloat(t.split(",")[1])]),s&&_.push([parseFloat(a.split(",")[0]),parseFloat(a.split(",")[1])]),l=Math.ceil(l),d=Math.ceil(d);var p=[];reverse_geocode_multiple_latlng(_,p,function(){o(l,d,p,i,n)})}function calculate_duration_geocode(e,t,a,r,s,n,o,i){var l={origin:t,destination:a,waypoints:r,optimizeWaypoints:!0,durationInTraffic:!0,travelMode:google.maps.TravelMode.DRIVING,provideRouteAlternatives:!0};directionsService.route(l,function(r,l){if(l==google.maps.DirectionsStatus.OK){if(e){for(var d=r.routes.length,_=0;d>_;_++){for(var c=new google.maps.Polyline({path:[],strokeColor:"#A8A8A8",strokeWeight:5}),m=r.routes[_].legs,u=0;u<m.length;u++)for(var p=m[u].steps,h=0;h<p.length;h++)for(var v=p[h].path,g=0;g<v.length;g++)c.getPath().push(v[g]);c.setMap(map),google.maps.event.addListener(c,"click",function(e){return function(){directionsDisplay.setRouteIndex(e),$(".price #fare").text(""),$(".price #road_tax").text(""),$(".price #toll").text(""),$(".price #travel_distance_charge").text(""),$(".price #travel_duration_charge").text(""),$(".price #waypoint_charge").text(""),$(".price #road_tax").text(""),$(".price #toll_tax").text(""),$(".price #distance").text(""),$(".price #travel_duration").text(""),$(".price #waiting_time").text(""),$(".price #duration").text(""),use_route(directionsDisplay.getDirections().routes[e],t,a,s,n,o,i)
}}(_))}

directionsDisplay.setDirections(r)
}

var f=r.routes[0];
use_route(f,t,a,s,n,o,i)}})}

function calcRoute(e,t,a){
	calculate_duration_geocode(!0,e,t,a,""==document.getElementById("from_address_state").value,""==document.getElementById("to_address_state").value,0,
		function(e,t,r,s){
	find_unique_states(r,function(n){var o="",i="";""!=document.getElementById("from_address_state").value&&(o=document.getElementById("from_address_state").value,n[0]!=o&&n.unshift(o),0==n.length&&n.unshift(o)),""!=document.getElementById("to_address_state").value&&(i=document.getElementById("to_address_state").value,n[n.length-1]!=i&&n.push(i),0==n.length&&n.unshift(o)),getEstimatedFare(e,a.length,t,n,s,r,document.getElementById("datetimepicker").value)})}),
	$("#map-canvas").is(":visible")||$("#map-canvas").show()}function find_unique_states(e,t){arr_pin=[];for(geocode_arr in e)arr_pin.push(e[geocode_arr][0]);


		$.ajax({url:"/map_postal_codes_to_states",method:"GET",data:{arr_pin:arr_pin},dataType:"json",success:function(e){state_arr=[],e.states.length>0&&state_arr.push(e.states[0]);for(var a=1;a<e.states.length;++a)e.states[a]!=state_arr[state_arr.length-1]&&state_arr.push(e.states[a]);t(state_arr)}})}

function getEstimatedFare(e,t,a,r,s,n,o){var i={order:{}},l=i.order;l.geo_region_id=$("#geo_region_request_id[type=hidden]").val(),l.vehicle_id=$("#vehicle_type_request_id[type=hidden]").val(),l.HourlyPackage_id=$("#hourly_package_type_id[type=hidden]").val(),l.is_return=$("#order_is_return").is(":checked")?1:0,l.is_premium=$("#order_is_premium").is(":checked")?1:0,l.estimated_distance=e,l.estimated_travel_duration=a,l.n_waypoints=t,l.states_traversed=r,l.start_time=o,$.ajax({url:"/orders/get_estimated_price",method:"GET",data:{order:i.order,geocode_results:n,duration_arr:s,vehicle_id:l.vehicle_id},dataType:"json",success:function(e){updateEstimatedFare(e)}})}

function updateEstimatedFare(e){var t=[];for(var a in e.params.geocode_results)t.push(e.params.geocode_results[a][0]);
	$.ajax({url:"/return_time_estimate_if_pincode_restricted",method:"POST",data:{array_pins:t,vehicle_type_request_id:e.params.vehicle_id,array_times:e.params.duration_arr,estimates:e.estimate[e.params.vehicle_id],start_time:e.params.order.start_time},dataType:"json",success:function(e){$(".price #loading-indicator").hide(),$(".price #fare").text("Estimated Fare: Rs. "+e.estimates.fare),$(".price #road_tax").text("Estimated Road Tax: Rs. "+e.estimates.road_tax),
		$(".price #toll").text("Estimated Toll Tax: Rs. "+e.estimates.toll),
		$(".price #travel_distance_charge").text("Travel Distance Charge: Rs. "+e.estimates.distance_charge),
		$(".price #travel_duration_charge").text("Travel Duration Charge: Rs. "+e.estimates.travel_duration_charge),
		$(".price #waypoint_charge").text("Waypoint Charge: Rs. "+e.estimates.waypoint_charge),$(".price #road_tax").text("Road Tax: Rs. "+e.estimates.road_tax),
		$(".price #toll_tax").text("Toll Tax: Rs. "+e.estimates.toll),
		$(".price #premium_discount").text("Premium Discount: - Rs. "+e.estimates.premium_discount),
		$(".price #return_discount").text("Return Discount: - Rs. "+e.estimates.return_discount),
		$(".price #distance").text("Estimated Distance: "+e.estimates.travel_distance+" kms"),""!=$("#hourly_package_type_id").val()?$(".price #hourly_package_name").text("Hourly Package: "+$("#hourly_package_type_id[type=text]").val()).show():$(".price #distance").show(),
		travel_duration=parseFloat(e.estimates.travel_duration),
		add_to_time_estimate=e.add_to_time_estimate/60,
		added_time=travel_duration+add_to_time_estimate,
		$(".price #travel_duration").text(Math.floor(travel_duration/60)>0?"Estimated Travel Duration: "+Math.floor(travel_duration/60)+" h "+travel_duration%60+" m":"Estimated Travel Duration: "+travel_duration+" mins"),$(".price #waiting_time").text(Math.floor(add_to_time_estimate/60)>0?"Waiting Time (Restrictions): "+Math.floor(add_to_time_estimate/60)+" h "+add_to_time_estimate%60+" m":"Waiting Time (Restrictions): "+add_to_time_estimate+" mins"),$(".price #duration").text(Math.floor(added_time/60)>0?"Estimated Duration: "+Math.floor(added_time/60)+" h "+added_time%60+" m":"Estimated Duration: "+added_time+" mins");for(var t in e.estimates){var a=document.getElementById("order_fare_"+t);null!=a&&(a.value=e.estimates[t])}$.rails.enableFormElements($($.rails.formSubmitSelector)),"order-confirm-order"!=pageType&&getEstimatedReachTime()}})}function get_geocode_and_store(e,t,a,r){var s=new google.maps.LatLng(e[t][0],e[t][1]),n=$("#geo_region_request_id[type=hidden]").val();"2"==n?(geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:s},function(s,n){if(n==google.maps.GeocoderStatus.OK){if(s[0])for(address=s[0].address_components,p=address.length-1;p>=0;p--)-1!=address[p].types.indexOf("postal_code")&&(a[t][0]=address[p].long_name),-1!=address[p].types.indexOf("administrative_area_level_1")&&(a[t][1]=address[p].long_name);for(var o=0;o<a.length;++o){if(""==a[o][1]){throttling=0;break}o==a.length-1&&r()}t+1<e.length&&get_geocode_and_store(e,t+1,a,r)}else throttling+=1,"ZERO_RESULTS"!=n?setTimeout(function(){get_geocode_and_store(e,t,a,r)},1500):(t>0&&(a[t]=a[t-1]),t+1<e.length&&get_geocode_and_store(e,t+1,a,r))})):r()}function reverse_geocode_multiple_latlng(e,t,a){for(var r=0;r<e.length;++r)t.push(["",""]);get_geocode_and_store(e,0,t,a)}function CalcRoute(){if($.rails.disableFormElements($($.rails.formSubmitSelector)),null!=document.getElementById("from_address_lat")){var e=document.getElementById("from_address_lat").value,t=document.getElementById("from_address_long").value,a=document.getElementById("to_address_lat").value,r=document.getElementById("to_address_long").value,s=(document.getElementById("datetimepicker").value,e+", "+t),n=a+", "+r,o=[];if("undefined"!=typeof waypts)for(i=1;i<waypts.length;i++)o.push({location:waypts[i],stopover:!0});calcRoute(s,n,o)}}function use_route(e,t,a,r,s,n,o){for(var i=[],l=0,d=0,_=[],c=0;c<e.legs.length;c++){l+=e.legs[c].distance.value/1e3,d+=e.legs[c].duration.value/60;var m=[];m.push(e.legs[c].steps[0].duration.value);for(var u=1;u<e.legs[c].steps.length;++u)m.push(m[u-1]+e.legs[c].steps[u].duration.value);last_duration_value=0;for(var u=0;u<e.legs[c].steps.length;u+=Math.ceil(e.legs[c].steps.length/(8/e.legs.length)))_.push([e.legs[c].steps[u].start_location.lat(),e.legs[c].steps[u].start_location.lng()]),i.push(m[u]-last_duration_value),last_duration_value=m[u]}r&&_.unshift([parseFloat(t.split(",")[0]),parseFloat(t.split(",")[1])]),s&&_.push([parseFloat(a.split(",")[0]),parseFloat(a.split(",")[1])]),l=Math.ceil(l),d=Math.ceil(d);var p=[];reverse_geocode_multiple_latlng(_,p,function(){o(l,d,p,i,n)})}function calculate_duration_geocode(e,t,a,r,s,n,o,i,l){var d={origin:t,destination:a,waypoints:r,optimizeWaypoints:!0,durationInTraffic:!0,travelMode:google.maps.TravelMode.DRIVING,provideRouteAlternatives:!0};directionsService.route(d,function(r,d){if(d==google.maps.DirectionsStatus.OK){if(directionsDisplay.setMap(map),e){for(var _=r.routes.length,c=0;_>c;c++){var m=new google.maps.Polyline({path:[],strokeColor:"#A8A8A8",strokeWeight:5});polylines.push(m);for(var u=r.routes[c].legs,p=0;p<u.length;p++)for(var h=u[p].steps,v=0;v<h.length;v++)for(var g=h[v].path,f=0;f<g.length;f++)m.getPath().push(g[f]);m.setMap(map),google.maps.event.addListener(m,"click",function(e){return function(){directionsDisplay.setRouteIndex(e),"undefined"!=typeof o&&o(directionsDisplay.getDirections().routes[e],t,a,s,n,i,l)}}(c))}directionsDisplay.setDirections(r)}if("undefined"!=typeof o){var b=r.routes[0];o(b,t,a,s,n,i,l)}}})}function reset_map(){for(var e in polylines)polylines[e].setMap(null);polylines=[],void 0!=directionsDisplay&&directionsDisplay.setMap(),void 0!=marker1&&marker1.setMap(null)}function use_route_callback(e,t,a,r){find_unique_states(a,function(s){var n="",o="";""!=document.getElementById("from_address_state").value&&(n=document.getElementById("from_address_state").value,s[0]!=n&&s.unshift(n),0==s.length&&s.unshift(n)),""!=document.getElementById("to_address_state").value&&(o=document.getElementById("to_address_state").value,s[s.length-1]!=o&&s.push(o),0==s.length&&s.unshift(n)),getEstimatedFare(e,waypts.length,t,s,r,a,document.getElementById("datetimepicker").value)})}function calcRoute(e,t,a){calculate_duration_geocode(!0,e,t,a,""==document.getElementById("from_address_state").value,""==document.getElementById("to_address_state").value,use_route,0,use_route_callback),$("#map-canvas").is(":visible")||$("#map-canvas").show()}function find_unique_states(e,t){arr_pin=[];for(geocode_arr in e)arr_pin.push(e[geocode_arr][0]);$.ajax({url:"/map_postal_codes_to_states",method:"GET",data:{arr_pin:arr_pin},dataType:"json",success:function(e){state_arr=[],e.states.length>0&&state_arr.push(e.states[0]);for(var a=1;a<e.states.length;++a)e.states[a]!=state_arr[state_arr.length-1]&&state_arr.push(e.states[a]);t(state_arr)}})}function getEstimatedFare(e,t,a,r,s,n,o){var i=Haversine(parseFloat($("#from_address_lat").val()),parseFloat($("#from_address_long").val()),parseFloat($("#to_address_lat").val()),parseFloat($("#to_address_long").val()));1>i&&e>7?($("#return_fare_div").show(),$("#order_is_return").prop("checked",!0).change()):($("#return_fare_div").hide(),$("#order_is_return").prop("checked",!1).change());var l={order:{}},d=l.order;d.geo_region_id=$("#order_geo_region_id").val(),d.vehicle_id=$("#vehicle_type_request_id[type=hidden]").val(),d.HourlyPackage_id=$("#hourly_package_type_id[type=hidden]").val(),d.is_return=$("#order_is_return").is(":checked")?1:0,d.is_premium=$("#order_is_premium").is(":checked")?1:0,d.estimated_distance=e,d.estimated_travel_duration=a,d.n_waypoints=t,d.states_traversed=r,d.start_time=o,$.ajax({url:"/orders/get_estimated_price",method:"GET",data:{order:l.order,geocode_results:n,duration_arr:s,vehicle_id:d.vehicle_id},dataType:"json",success:function(e){updateEstimatedFare(e,!0)}})}function includePincodeRestrictionInDuration(e,t,a){if("undefined"!=typeof e&&"undefined"!=typeof t){var r=[];for(var s in travel_data.params.geocode_results)r.push(travel_data.params.geocode_results[s][0]);$.ajax({url:"/return_time_estimate_if_pincode_restricted",method:"POST",data:{array_pins:r,vehicle_type_request_id:e,array_times:travel_data.params.duration_arr,estimates:travel_data.estimate,start_time:t},dataType:"json",success:function(e){window.complete_data_response=e,"undefined"!=typeof a&&a()}})}}function updateEstimatedFare(e,t){if(window.travel_data=e,window.estimated_data=e.estimate,"order-confirm-order"!=pageType){for(var a in e.estimate)$(".each_vehicle[data-vehicle-id="+a+"]").find(".num_of_vehicles_available").find("span").text(e.estimate[a].available_vehicles),$(".each_vehicle[data-vehicle-id="+a+"]").find(".vehicle_fare").find("span").text(e.estimate[a].fare),0==e.estimate[a].available_vehicles&&($(".each_vehicle[data-vehicle-id="+a+"]").find(".vehicle_book_now_btn").removeClass("btn-primary").addClass("btn-default"),$(".each_vehicle[data-vehicle-id="+a+"]").find(".vehicle_book_now_btn").attr("disabled","disabled")),$("#order_vehicle_id").val()==a&&($(".all_vehicle_info").removeClass("selected-vehicle"),$(".each_vehicle[data-vehicle-id="+a+"]").find(".all_vehicle_info").addClass("selected-vehicle"));t&&getEstimatedReachTime()}}function get_geocode_and_store(e,t,a,r){var s=new google.maps.LatLng(e[t][0],e[t][1]),n=$("#order_geo_region_id").val();"2"==n?(geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:s},function(s,n){if(n==google.maps.GeocoderStatus.OK){if(s[0])for(address=s[0].address_components,p=address.length-1;p>=0;p--)-1!=address[p].types.indexOf("postal_code")&&(a[t][0]=address[p].long_name),-1!=address[p].types.indexOf("administrative_area_level_1")&&(a[t][1]=address[p].long_name);for(var o=0;o<a.length;++o){if(""==a[o][1]){throttling=0;break}o==a.length-1&&r()}t+1<e.length&&get_geocode_and_store(e,t+1,a,r)}else throttling+=1,"ZERO_RESULTS"!=n?setTimeout(function(){get_geocode_and_store(e,t,a,r)},1500):(t>0&&(a[t]=a[t-1]),t+1<e.length&&get_geocode_and_store(e,t+1,a,r))})):r()}function reverse_geocode_multiple_latlng(e,t,a){for(var r=0;r<e.length;++r)t.push(["",""]);get_geocode_and_store(e,0,t,a)}function ReScanForValidations(){delete frmvalidator,"admin-place-order"==pageType?frmvalidator=new ValidateForm("place_order"):"admin-edit-order"==pageType&&(frmvalidator=new ValidateForm("edit_order_status")),frmvalidator.formobj&&(frmvalidator.EnableOnPageErrorDisplay(),frmvalidator.EnableMsgsTogether(),frmvalidator.setAddnlValidationFunction("ValidatePlaceOrder"))}function resetVehicleData(){$(".vehicle_outer_block .confirm_vehicle_block").hide(),"admin-place-order"==pageType&&$("#order_vehicle_id").val(""),$(".each_vehicle").find(".all_vehicle_info").addClass("wrong-input-no-border"),resetHeadings()}function book_now_function(e){window.book_later_min_time=null,window.book_now_min_time=new Date(e),$("#datetimepicker").val(get_time_from_time_stamp(new Date(new Date(e).getTime()))).change()}function book_later_function(e){if(window.book_now_min_time=null,$(e).parents(".each_vehicle").find(".vehicle_book_now_btn").attr("disabled")){var t=new Date;window.book_later_min_time=new Date(t.getTime()+72e5)}else{var a=new Date($(e).parents(".each_vehicle").find(".date_object_expected_time_arrival").val());window.book_later_min_time=new Date(a.getTime()+9e5)}$("#datetimepicker").trigger("open")}function enableBookNowButton(){$("#book_order_now").removeClass("btn-default").addClass("btn-primary"),$("#book_order_now").removeAttr("disabled")}function disableBookNowButton(){$("#book_order_now").removeClass("btn-primary").addClass("btn-default"),$("#book_order_now").attr("disabled","disabled")}function resetHeadings(){$(".outer-common").each(function(){$(this).find(".wrong-input").length>0||$(this).find(".wrong-input-no-border").length>0?$(this).find(".place-order-section-heading").addClass("alert-danger").removeClass(".alert-info"):$(this).find(".place-order-section-heading").removeClass("alert-danger").addClass(".alert-info")})}function add_waypoint_div(e,t){var a=document.createElement("div");a.id="Waypoint_No_"+e;a.innerHTML="<div class='inputBlock' style='width:540px'><label for='waypoint_"+e+"_address_landmark'>Waypoint Landmark "+e+": *</label><input type='text' name='waypoint_"+e+"_address_landmark' autocomplete='off' id='waypoint_"+e+"_address_landmark' placeholder='Waypoint_"+e+" landmark' class='waypoints dynamic-border-input wrong-input' validation_required='req'><a class='btn btn-danger' href='javascript:void(0)' onclick=\"deleteInput("+e+",'waypoints')\" style='margin-left: 23px; line-height: 19px'><i class='fa fa-close'></i></a><span id='"+$("form").eq(0).attr("id")+"_waypoint_"+e+"_address_landmark_errorloc' class='error'></span><span id='"+$("form").eq(0).attr("id")+"_waypoint_"+e+"_address_lat_errorloc' class='error'></span><span id='"+$("form").eq(0).attr("id")+"_waypoint_"+e+"_address_long_errorloc' class='error'></span><input type='hidden' name='waypoint_"+e+"_address_lat' id='waypoint_"+e+"_address_lat'><input type='hidden' name='waypoint_"+e+"_address_long' id='waypoint_"+e+"_address_long'></div>";var r="waypoint_"+e+"_address_landmark",s=$(a);s.find(".dynamic-border-input").keyup(function(){$(this).val().length>0?$(this).removeClass("wrong-input"):$(this).addClass("wrong-input")}),document.getElementById(t).appendChild(a);var n=process_element_for_validations(document.getElementById(r));"admin-place-order"==pageType?add_validation(r,n[0][0],n[1][0],document.forms.place_order):"admin-edit-order"==pageType&&add_validation(r,n[0][0],n[1][0],document.forms.edit_order_status),addMapsAutoCompleteListener("waypoint_"+e+"_address_landmark",fillInWaypoint,e),resetHeadings()}function addWaypoints(e){var t=parseInt(document.getElementById("waypoint_count").value)+1;t-1==limit?alert("You have reached the limit of adding "+(t-1)+" inputs"):(add_waypoint_div(t,e),document.getElementById("waypoint_count").value=t,t++)}function ValidatePlaceOrder(){"admin-place-order"==pageType?frm=document.forms.place_order:"admin-edit-order"==pageType&&(frm=document.forms.edit_order_status);var e=DoCustomValidation(frm);if(!e)return!1;for(i=1;i<parseInt(document.getElementById("waypoint_count").value)+1;++i){var t="waypoint_"+i+"_address_landmark",a="waypoint_"+i+"_address_lat",r="waypoint_"+i+"_address_long";if(!frm[a].value&&!frm[r].value)return sfm_show_error_msg("Invalid Waypoint!",frm[t]),!1}return!0}function fillInWaypoint(e,t){var a=t.getPlace(),r=a.geometry,s="waypoint_"+e+"_address_long",n="waypoint_"+e+"_address_lat";document.getElementById(n).value=r.location.lat(),document.getElementById(s).value=r.location.lng(),waypts.push({location:new google.maps.LatLng(r.location.lat(),r.location.lng()),stopover:!0}),draw_marker_or_path()}function deleteInput(e,t){var a=e,r=parseInt(document.getElementById("waypoint_count").value)+1;if(1>=r)alert("You have reached the limit of deleting inputs");else{waypts.splice(a-1,1),r--,document.getElementById("waypoint_count").value=r;{var s=document.getElementById(t);document.getElementById("Waypoint_No_"+a)}for(i=a;i<r;++i)count_i=i+1,document.getElementById("waypoint_"+i+"_address_landmark").value=document.getElementById("waypoint_"+count_i+"_address_landmark").value,document.getElementById("waypoint_"+i+"_address_long").value=document.getElementById("waypoint_"+count_i+"_address_long").value,document.getElementById("waypoint_"+i+"_address_lat").value=document.getElementById("waypoint_"+count_i+"_address_lat").value,document.getElementById("waypoint_"+i+"_address_lat").value=document.getElementById("waypoint_"+count_i+"_address_lat").value;s.removeChild(s.lastChild),document.getElementById("waypoint_count").value=r-1,resetHeadings()}draw_marker_or_path()}function get_pincode_restrictions(e){$.ajax({url:"/restservice/return_pincode_restriction_for_vehicle_for_pincode",method:"GET",data:{pincode:e[0][0]},dataType:"json",success:function(e){pickup_restricted_pins=e}})}function landmark_to_lat_lang(landmark,autoCompleteObject){var place=autoCompleteObject.getPlace(),geometry=place.geometry;if("from"==landmark){for(document.getElementById("from_address_lat").value=geometry.location.lat(),document.getElementById("from_address_long").value=geometry.location.lng(),address=place.address_components,p=address.length-1;p>=0;p--)-1!=address[p].types.indexOf("administrative_area_level_1")&&(document.getElementById("from_address_state").value=address[p].long_name);var arr=[];arr.push([$("#from_address_lat").val(),$("#from_address_long").val()]);var from_pincode=[];with({obj:arr,from_pincode_ajax:from_pincode})reverse_geocode_multiple_latlng(arr,from_pincode_ajax,function(){get_pincode_restrictions(from_pincode_ajax)});$("div#full_from_address").show(),"admin-place-order"==pageType&&draw_marker_or_path()}else if("to"==landmark){for(document.getElementById("to_address_lat").value=geometry.location.lat(),document.getElementById("to_address_long").value=geometry.location.lng(),address=place.address_components,p=address.length-1;p>=0;p--)-1!=address[p].types.indexOf("administrative_area_level_1")&&(document.getElementById("to_address_state").value=address[p].long_name);$("div#full_to_address").show(),"admin-place-order"==pageType&&draw_marker_or_path()}}


function initialize_place_order(){addMapsAutoCompleteListener("from_address_landmark",landmark_to_lat_lang,"from"),addMapsAutoCompleteListener("to_address_landmark",landmark_to_lat_lang,"to"),ReScanForValidations(),changeBoundsForGoogleMapAutoComplete("order_geo_region_id")}

function initialize_map_place_order(e){initialize_map(e),marker1=new google.maps.Marker({map:map,title:"Vehicle"})}


function draw_marker_or_path(){reset_map();var e=""!=$("#from_address_lat").val()&&""!=$("#from_address_long").val(),t=""!=$("#to_address_lat").val()&&""!=$("#to_address_long").val();if(0==$("location-heading").find(".alert-danger").length&&"admin-place-order"==pageType&&resetVehicleData(),e&&t){var a=$("#from_address_lat").val()+", "+$("#from_address_long").val(),r=$("#to_address_lat").val()+", "+$("#to_address_long").val();
calculate_duration_geocode(!0,a,r,waypts,""==document.getElementById("from_address_state").value,
	""==document.getElementById("to_address_state").value,use_route,0,use_route_callback),$(".each_vehicle").find(".vehicle_book_later_btn").removeClass("btn-default").addClass("btn-primary"),$(".each_vehicle").find(".vehicle_book_later_btn").removeAttr("disabled"),$("#from_address_lat").val()===$("#to_address_lat").val()&&$("#from_address_long").val()===$("#to_address_long").val()&&0==$("#waypoints").children().length&&($("#warning_modal_crm #reminder_message").text("Please Ask a waypoint"),$("#warning_modal_crm").modal("show"))}else"admin-place-order"==pageType&&resetVehicleData(),$(".each_vehicle").find(".vehicle_book_later_btn").removeClass("btn-primary").addClass("btn-default"),$(".each_vehicle").find(".vehicle_book_later_btn").attr("disabled","disabled"),e&&(marker1.setMap(map),marker1.setPosition(new google.maps.LatLng($("#from_address_lat").val(),$("#from_address_long").val())),map.setCenter(marker1.getPosition()))}

function populateAllVehicleInRegionWithInfo(){var e=$("#order_geo_region_id").val();



//$.ajax({url:"https://survey.theporter.in/restservice/get_all_vehicle_info_by_region",method:"GET",data:{geo_region_id:e},dataType:"json",success:function(e){makeVehicleBlocks(e.vehicle_map)}})

makeVehicleBlocks(vinfo[e].vehicle_map);

}
function makeVehicleBlocks(e){$(".vehicle_selection_block").empty();for(var t=0;t<e.length;t++){var a="";a=a+"<div class='each_vehicle' data-vehicle-id="+e[t].vehicle_id+">",a+="<div class='all_vehicle_info wrong-input-no-border '>",a+="<input type='hidden' class='date_object_expected_time_arrival'>",a=a+"<div class='vehicle_name'>"+e[t].vehicle.vehicle_type,a+="</div>",a+="<div class='num_of_vehicles_available'> <b>No. of vehicles :</b> <span></span>",a+="</div>",a+="<div class='expected_time_arrival'>  ETA <span></span>  ",a+="</div>",a+="<div class='vehicle_fare alert alert-success'>  &#8377;  <span></span>",a+="</div>",a+="<div class='vehicle_details'>",a=a+"<div class='capacity'> Capacity :"+e[t].capacity,a+="</div>",a=a+"<div class='size'> Size :"+e[t].size,a+="</div>",a+="</div>",a+="</div>",a+="<button type='button' class='btn btn-default vehicle_book_now_btn' disabled='disabled'> Book Now</button>",a+="<button type='button' class='btn btn-default vehicle_book_later_btn' disabled='disabled'> Book Later</button>",a+="</div>",$(".vehicle_selection_block").append(a)}}


function getEstimatedReachTime(){
	var e={order:{}},t=e.order;t.geo_region_id=$("#order_geo_region_id").val(),t.from_address_lat=$("#from_address_lat[type=hidden]").val(),t.from_address_long=$("#from_address_long[type=hidden]").val(),$.ajax({url:"/administrators/estimated_reach_time.json",method:"GET",data:e,dataType:"json",success:function(e){window.message=e,updateEstimatedtime(e)}})}

function calcEstimatedTime(e,t,a){var r={origin:e,destination:t,durationInTraffic:!0,travelMode:google.maps.TravelMode.DRIVING,provideRouteAlternatives:!0},s=0,n=0;

duration_array=[],count_duration=0,directionsService.route(r,function(e,t){if(t==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(e);

alert(11);

var r=e.routes[0];s=0,n=0;for(var o=0;o<r.legs.length;o++)s+=r.legs[o].distance.value/1e3,n+=r.legs[o].duration.value/60,n=parseFloat(n).toFixed(1);updateDuration(n,a)}})}function updateDuration(e,t,a){var r=document.getElementById("datetimepicker").value,s=new Date(r),n=new Date,o=s-n,i=Math.floor(o%864e5%36e5/6e4);e>i&&0==t&&$("#driver_reach_status").text("The first driver in the list will reach at "+a.toLocaleTimeString()+" if they leave now.")}function get_time_from_time_stamp(e){var t=new Array;t[0]="Jan",t[1]="Feb",t[2]="Mar",t[3]="Apr",t[4]="May",t[5]="Jun",t[6]="Jul",t[7]="Aug",t[8]="Sep",t[9]="Oct",t[10]="Nov",t[11]="Dec",d="Not Yet Known";var a=e.getHours(),r=e.getMinutes(),s=a>=12?"PM":"AM";a%=12,a=a?a:12,r=10>r?"0"+r:r;var n=a+":"+r+" "+s,o=e.getDate(),i=e.getMonth(),l=e.getFullYear(),d=o+"/"+t[i]+"/"+l+" "+n;return d}function compute_duration_using_geocodes(e,t,a,r,s){if(t[e[s]].length>0){var n=t[e[s]][0].last_location.lat+", "+t[e[s]][0].last_location["long"];calculate_duration_geocode(!1,n,a,r,!1,!1,use_route,s,function(s,n,o,i,l){arr_pin=[];for(geocode in o)arr_pin.push(o[geocode][0]);nearest_driver_vehicle=t[e[l]],date=new Date(Date.now()),$.ajax({url:"/return_time_estimate_if_pincode_restricted",method:"POST",data:{array_pins:arr_pin,vehicle_type_request_id:t[e[l]].vehicle_id,array_times:i,start_time:date.toLocaleTimeString(),duration:n},dataType:"json",success:function(a){var r=parseFloat(parseFloat(a.params.duration)+parseFloat(a.add_to_time_estimate)/60).toFixed(1),s=new Date(date.getTime()+60*r*1e3+27e5),n=s-Date.now(),o="",i="",d="";(i=n/60/1e3/60)>1&&(o+=Math.floor(i)+" h"),(d=Math.floor(n/60/1e3-60*Math.floor(i)))>1&&(o+=d+" min");var _=t[e[l]][0];$(".each_vehicle[data-vehicle-id="+_.vehicle_id+"]").find(".expected_time_arrival").empty().append("<span>ETA: "+s.toLocaleTimeString()+"( "+o+" )</span>"),$(".each_vehicle[data-vehicle-id="+_.vehicle_id+"]").find(".date_object_expected_time_arrival").attr("value",s),$("#order_vehicle_id").val()==_.vehicle_id&&$(".each_vehicle[data-vehicle-id="+_.vehicle_id+"]").find(".vehicle_book_now_btn").click()}}),l+1<e.length&&compute_duration_using_geocodes(e,t,a,r,l+1)})}else s+1<e.length&&compute_duration_using_geocodes(e,t,a,r,s+1)}function updateEstimatedtime(e){window.nearest_drivers_details=e.nearest_drivers_details;var t=document.getElementById("from_address_lat").value,a=document.getElementById("from_address_long").value,r=t+", "+a,s=[],n=Object.keys(nearest_drivers_details);compute_duration_using_geocodes(n,nearest_drivers_details,r,s,0);for(x in nearest_drivers_details)nearest_drivers_details[x].length>0&&(driver=nearest_drivers_details[x][0],$(".each_vehicle[data-vehicle-id="+driver.vehicle_id+"]").find(".expected_time_arrival").empty().append("<img style='display:block;margin:auto;height:60%;' src='/assets/progress-bcfc4de3a54e646b8fd90b6869593d1150cbddafb1bc4e50f79297d81ea4473b.gif'/>"),$(".each_vehicle[data-vehicle-id="+driver.vehicle_id+"]").find(".vehicle_book_now_btn").removeClass("btn-default").addClass("btn-primary"),$(".each_vehicle[data-vehicle-id="+driver.vehicle_id+"]").find(".vehicle_book_now_btn").removeAttr("disabled"))}function disable_timings_in_datetimepicker(e){if(hours_minutes_to_block=[],"undefined"!=pickup_restricted_pins[e])for(var t in pickup_restricted_pins[e])for(var a=new Date(pickup_restricted_pins[e][t][0]),r=new Date(pickup_restricted_pins[e][t][1]),s=0,n=a;r>=n;n.setTime(a.getTime()+9e5))hours_minutes_to_block.push([n.getHours(),n.getMinutes()]),++s}function populate_vehicle_fare_details(e,t,a){var r=$(e).parents(".each_vehicle");$(".confirm_vehicle_block .vehicle_name").html(r.find(".vehicle_name").text()),$(".confirm_vehicle_block .vehicle_details .capacity").html(r.find(".vehicle_details .capacity").text()),$(".confirm_vehicle_block .vehicle_details .size").html(r.find(".vehicle_details .size").text()),$(".confirm_vehicle_block .estimated_fare").html(r.find(".vehicle_fare").text()),$(".confirm_vehicle_block .travel_distance").html(a.travel_distance+" kms"),$(".confirm_vehicle_block .travel_duration").html(a.travel_duration+" mins"),"undefined"!=typeof complete_data_response?($(".confirm_vehicle_block .waiting_duration").html(complete_data_response.add_to_time_estimate/60+" mins"),$(".confirm_vehicle_block .total_duration").html(parseInt(complete_data_response.estimates[t].travel_duration)+parseInt(complete_data_response.add_to_time_estimate/60)+" mins")):$(".confirm_vehicle_block .total_duration").html(parseInt(a.travel_duration)+" mins"),$(".confirm_vehicle_block .base_fare").html("&#8377;"+a.base_fare),$(".confirm_vehicle_block .toll_tax").html("&#8377;"+a.toll),$(".confirm_vehicle_block .road_tax").html("&#8377;"+a.road_tax),$(".confirm_vehicle_block .premium_discount").html("&#8377;"+a.premium_discount),$(".confirm_vehicle_block .return_discount").html("&#8377;"+a.return_discount),$(".confirm_vehicle_block .duration_charge").html("&#8377;"+a.travel_duration_charge),a.available_vehicles>0?$(".confirm_vehicle_block .num_of_vehicles_available").addClass("alert-success").removeClass("alert-danger"):$(".confirm_vehicle_block .num_of_vehicles_available").addClass("alert-danger").addClass("alert-success"),$(".confirm_vehicle_block .num_of_vehicles_available").html("Number of Available Vehicles: &nbsp;"+a.available_vehicles),0==a.available_vehicles?disableBookNowButton():enableBookNowButton(),$(".confirm_vehicle_block .expected_time_arrival").text($(".each_vehicle[data-vehicle-id="+t+"]").find(".expected_time_arrival").find("span").text());var s=0,n="";distances_array=a.distances_array,fare_array=a.fare_array;for(var o=0;o<distances_array.length;o++)n+="<p class='fare-details-each'>",n=n+"<span class='field'>Charge for "+Math.floor(s)+"-"+Math.floor(parseFloat(distances_array[o])+s)+"kms</span> &nbsp;",n=n+"<span class='value'> &#8377;"+parseFloat(fare_array[o]).toFixed(2)+"</span>",n+="</p>",s=parseFloat(distances_array[o])+s;$(".confirm_vehicle_block .distance_split").html(n),disable_timings_in_datetimepicker(t)}function update_fare_hidden_fields(e){$(".confirm_vehicle_block ");var t=$(e).parents(".each_vehicle").attr("data-vehicle-id");$("#order_fare_fare").val(complete_data_response.estimates[t].fare),$("#order_fare_travel_fare").val(complete_data_response.estimates[t].travel_fare),$("#order_fare_travel_duration").val(complete_data_response.estimates[t].travel_duration),$("#order_fare_travel_duration_charge").val(complete_data_response.estimates[t].travel_duration_charge),$("#order_fare_travel_distance").val(complete_data_response.estimates[t].travel_distance),$("#order_fare_distance_charge").val(complete_data_response.estimates[t].distance_charge),$("#order_fare_base_fare").val(complete_data_response.estimates[t].base_fare),$("#order_fare_toll_tax").val(complete_data_response.estimates[t].toll),$("#order_fare_road_tax").val(complete_data_response.estimates[t].road_tax)}function updatePreviewAndBook(){var e="";e+="<div class='profile-section'>",e+="<p class='preview-heading' data-shortcut-to='other_order_parameters' > Order Details </p>",$("#order_fare_fare").val()>0&&(e+="<p class='preview-profile-details'><span class='field'> Estimated Fare </span><span class='value'> &#8377 "+$("#order_fare_fare").val()+"</span> </p>"),""!=$("#order_vehicle_id").val()&&(e+="<p class='preview-profile-details'><span class='field'> Vehicle Type </span><span class='value'> "+$(".each_vehicle[data-vehicle-id="+$("#order_vehicle_id").val()+"]").find(".vehicle_name").text()+"</span> </p>"),""!=$("#datetimepicker").val()&&(e+="<p class='preview-profile-details'><span class='field'> Pickup Time </span><span class='value'> "+$("#datetimepicker").val()+"</span> </p>"),""!=$("#order_business_type_description").val()&&(e+="<p class='preview-profile-details'><span class='field'> Type of Goods </span><span class='value'> "+$("#order_business_type_description").val()+"</span> </p>"),""!=$("#order_quantity_of_goods").val()&&(e+="<p class='preview-profile-details'><span class='field'> Quantity of Goods </span><span class='value'> "+$("#order_quantity_of_goods").val()+"</span> </p>"),e+="<p class='preview-profile-details'><span class='field'> Acknowledgement </span><span class='value'> ",e+=$("#acknowledgement").is(":checked")?"true":"false",e+="</span> </p>",e+="<p class='preview-profile-details'><span class='field'> Payment </span><span class='value'> ",e+=$("#order_postpaid_true").is(":checked")?"Postpaid":"Prepaid",e+="</span> </p>",$("#order_labourers").val()>0&&(e+="<p class='preview-profile-details'><span class='field'> Labourers </span><span class='value'> "+$("#order_labourers").val()+"</span> </p>"),e+="</div>",e+="<div class='profile-section'>",e+="<p class='preview-heading' data-shortcut-to='location_section'> Location Details </p>",$("#from_address").val().length>0&&(e+="<p class='preview-profile-details'><span class='field'> From Address </span><span class='value'> "+$("#from_address").val()+"</span> </p>"),$("#from_address_landmark").val().length>0&&(e+="<p class='preview-profile-details'><span class='field'> From Address Landmark </span><span class='value'> "+$("#from_address_landmark").val()+"</span> </p>");for(var t=1;t<=$("#waypoint_count").val();++t)$("#waypoint_"+t+"_address_landmark").val().length>0&&(e+="<p class='preview-profile-details'><span class='field'> Waypoint "+t+" </span><span class='value'> "+$("#waypoint_"+t+"_address_landmark").val()+"</span> </p>");$("#to_address").val().length>0&&(e+="<p class='preview-profile-details'><span class='field'> To Address </span><span class='value'> "+$("#to_address").val()+"</span> </p>"),$("#to_address_landmark").val().length>0&&(e+="<p class='preview-profile-details'><span class='field'> To Address Landmark </span><span class='value'> "+$("#to_address_landmark").val()+"</span> </p>"),e+="</div>",e+="<div class='preview-left profile-section'>",e+="<p class='preview-heading' data-shortcut-to='profile_section_top' > Profile </p>",($("#first_name").val().length>0||$("#last_name").val().length>0)&&(e+="<p class='preview-profile-details'><span class='field'> Customer Name </span><span class='value'> "+$("#first_name").val()+" "+$("#last_name").val()+"</span> </p>"),e+="<p class='preview-profile-details'><span class='field'> Mobile </span><span class='value'> "+$("#order_customer_mobile").val()+"</span> </p>",$("#company_name").val()!=$("#first_name").val()+" "+$("#last_name").val()&&(e+="<p class='preview-profile-details'><span class='field'> Company Name </span><span class='value'> "+$("#company_name").val()+"</span> </p>"),e+="<p class='preview-profile-details'><span class='field'> Premium Customer </span><span class='value'> ",e+=$("#order_is_premium").is(":checked")?"true":"false",e+="</span> </p>",$("#email").val().length>0&&(e+="<p class='preview-profile-details'><span class='field'> Email </span><span class='value'> ",e+=$("#email").val(),e+="</span> </p>"),e+="</div>",$("#preview-block").html(e)
}function addRemoveLabourFromTermsAndConditions(e){if("Household Items"==e){if(0==$("#labour_required").length){var t="";t+="<div style='display: block'>",t+="<input id='labour_required' name='labour_required' type='checkbox' validation_required='tick_checkbox' value='1'>",t+=" <label for='labour_required' style='margin-right: 30px; width: 250px'>Labour Required</label>",t+="<span style='margin-left: 20px; visibility: visible;' id='"+$("form").eq(0).attr("id")+"_labour_required_errorloc' class='error'></span>",t+="</div>";var a=$(t);$(".terms_and_condition").append(a)}}else $(".terms_and_condition").find("#labour_required").length>0&&$(".terms_and_condition").find("#labour_required").parent("div").remove()}function highlightTermsAndConditions(){var e=!0;$(".terms_and_condition input[type=checkbox]").each(function(){return $(this).is(":checked")?void 0:(e=!1,!1)}),1==e?$(".terms_and_condition").removeClass("alert-danger"):$(".terms_and_condition").addClass("alert-danger")}var directionsDisplay,directionsService=new google.maps.DirectionsService,stepDisplay,map,marker1,home_location=new google.maps.LatLng(19.05,72.9258);addMapsAutoCompleteListener.autocomplete_element=[],ValidateForm.prototype.processForm=function(){for(var e=$(this.formobj).find("select,input,textarea"),t=0;t<e.length;++t){var a=e[t],r=process_element_for_validations(a);if(r[0]&&r[1]){r[0].length!=r[1].length;for(var s=0;s<r[0].length;++s)this.addValidation(a.id,r[0][s],r[1][s],this.formobj)}}};var XMLHttpRequestObject=!1;try{XMLHttpRequestObject=new XMLHttpRequest}catch(e){try{XMLHttpRequestObject=new ActiveXObject("MSXML2.XMLHTTP")}catch(e){try{XMLHttpRequestObject=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){XMLHttpRequestObject=!1,alert("Your browser broke!")}}}$(document).ready(function(){initialize_map("confirm-order")});var deactive_map_directions=[],throttling=0,deactive_map_directions=[],polylines=[],throttling=0,hours_minutes_to_block=[];$(document).ready(function(){initialize_map_place_order("place-order"),resetHeadings(),$("body").on("click",".refresh_vehicles_and_fare",function(){draw_marker_or_path()}),$("#save_for_later").click(function(){frmvalidator.clearAllValidations()}),$(".order-radio").click(function(){$.ajax({url:"/restservice/get_order_details",method:"GET",data:{order_id:$(this).val()},dataType:"json",success:function(e){$("#from_address_landmark").val(e.from_address_landmark).change(),$("#from_address_lat").val(e.from_address_lat).change(),$("#from_address_long").val(e.from_address_long).change(),$("#to_address_landmark").val(e.to_address_landmark).change(),$("#to_address_lat").val(e.to_address_lat).change(),$("#to_address_long").val(e.to_address_long).change(),$("#from_address").val(e.from_address).change(),$("#to_address").val(e.to_address).change(),$("#order_vehicle_id").val(e.vehicle_id).change(),$("#order_quantity_of_goods").val(e.quantity_of_goods).change(),null!=e.business_types_id&&$("#order_business_types_id").val(e.business_types_id).change(),$("#order_business_type_description").val(e.business_type_description).change(),e.postpaid?$("#order_postpaid_true").prop("checked",!0).change():$("#order_postpaid_false").prop("checked",!0).change(),$("#order_is_premium").val()?$("#order_is_premium").prop("checked",!0).change():$("#order_is_premium").prop("checked",!1).change(),draw_marker_or_path()}})}),$("#from_address_landmark").keyup(function(){$("#from_address_lat").val(""),$("#from_address_long").val(""),draw_marker_or_path()}),$("#to_address_landmark").keyup(function(){$("#to_address_lat").val(""),$("#to_address_long").val(""),draw_marker_or_path()}),$(".copy_from_checkbox").change(function(){var e=$(this).attr("data-copy-to");if(this.checked){var t=$(this).attr("data-copy-from");$("#"+e).val($("#"+t).val()).change()}else $("#"+e).val("").change()}),$("body").on("keyup change",".dynamic-border-input",function(){$(this).val().length>0?$(this).removeClass("wrong-input"):$(this).addClass("wrong-input"),resetHeadings()}),$("#from_address_landmark").keyup(function(){$("#from_address_lat").val(""),$("#from_address_long").val(""),draw_marker_or_path()}),$("#to_address_landmark").keyup(function(){$("#to_address_lat").val(""),$("#to_address_long").val(""),draw_marker_or_path()}),$("#datetimepicker").datetimepicker({step:15,minDate:0,onChangeDateTime:dateTimePickerLogic,onShow:dateTimePickerLogic,format:"d/M/Y  g:i  A",formatTime:"A  g:i",onGenerate:function(currentDateTime){$(".xdsoft_time").each(function(index){with({obj:this})$.each(hours_minutes_to_block,function(e,t){$(obj).find(".disabled_by_pincode").length>0&&($(obj).removeClass("xdsoft_disabled"),$(obj).removeClass("disabled_by_pincode")),t[0]==$(obj).attr("data-hour")&&t[1]==$(obj).attr("data-minute")&&($(obj).addClass("xdsoft_disabled"),$(obj).addClass("disabled_by_pincode"))})})},onSelectDate:function(){$("#datetimepicker").val("")}}),$("#order_geo_region_id").change(function(){populateAllVehicleInRegionWithInfo(),changeMapCenter($("#order_geo_region_id").val())});var time_etimate_computed_at="";$("#datetimepicker").change(function(){if(time_etimate_computed_at!=$(this).val()&&!$(".xdsoft_datetimepicker").is(":visible")){time_etimate_computed_at=$(this).val();var e=new Date($(this).val());includePincodeRestrictionInDuration($("#order_vehicle_id").val(),e,function(){populate_vehicle_fare_details($(".each_vehicle[data-vehicle-id="+$("#order_vehicle_id").val()+"]").find(".all_vehicle_info"),$("#order_vehicle_id").val(),complete_data_response.estimates[$("#order_vehicle_id").val()])})}}),$(".vehicle_outer_block").on("click",".all_vehicle_info,.vehicle_book_later_btn,.vehicle_book_now_btn",function(event){$(".vehicle_outer_block .confirm_vehicle_block").show(),$(".all_vehicle_info").removeClass("wrong-input-no-border"),resetHeadings(),$(this).hasClass("vehicle_book_now_btn")&&(("undefined"==typeof edit_order_pickup_time_update||1==edit_order_pickup_time_update)&&book_now_function($(this).parents(".each_vehicle").find(".date_object_expected_time_arrival").val()),edit_order_pickup_time_update=!0),$(this).hasClass("vehicle_book_later_btn")&&book_later_function(this);var date=new Date(Date.now());with($(this).hasClass("all_vehicle_info")&&($(obj).find(".expected_time_arrival").find("span").text().length>0?enableBookNowButton():disableBookNowButton()),$("#order_vehicle_id").val($(this).parents(".each_vehicle").attr("data-vehicle-id")),{obj:this})populate_vehicle_fare_details(this,$(obj).parents(".each_vehicle").attr("data-vehicle-id"),travel_data.estimate[$("#order_vehicle_id").val()]),includePincodeRestrictionInDuration($(this).parents(".each_vehicle").attr("data-vehicle-id"),date,function(){update_fare_hidden_fields(obj)})}),$("#book_order_now").click(function(){book_now_function($(".each_vehicle[data-vehicle-id="+$("#order_vehicle_id").val()+"]").find(".date_object_expected_time_arrival").val())}),$("#book_order_later").click(function(){book_later_function()}),$("#add_sms_numbers").click(function(){var e="",t=$("#sms_number_list").find(".each_sms_number").length+1;e+="<div class='each_sms_number inputBlock'>",e+="<label>Sms Mobile : </label>",e+="<input name='order[sms_numbers][]' id='order_sms_number_"+t+"' validation_required= 'req, numeric, maxlength=11,minlength=10'>",e+="<span style='display: inline-block;margin-left: 15px;' id='"+$("form").eq(0).attr("id")+"_order_sms_number_"+t+"_errorloc' class='error'></span>",e+="<a class='btn btn-danger remove_sms_number' href='javascript:void(0)'  style='margin-left: 23px; line-height: 19px'>",e+="<i class='fa fa-close'></i>",e+="</a>",e+="</div>",$("#sms_number_list").append(e),ReScanForValidations()}),$("body").on("click",".remove_sms_number",function(){$(this).parents(".each_sms_number").remove(),ReScanForValidations()}),$("body").on("change",".terms_and_condition input[type=checkbox]",function(){highlightTermsAndConditions()}),$(".vehicle_selection_block ").on("click",".vehicle_book_now_btn",function(){}),$(".nature-of-goods-block select").change(function(){"11"==$(this).val()?($("#order_labourers").val(""),$("#order_labourers").attr("validation_required","req")):($("#order_labourers").val(""),$("#order_labourers").attr("validation_required","")),ReScanForValidations()}),$(".close_confirm_vehicle_block").on("click",function(){resetVehicleData()}),$("#is_an_individual").click(function(){this.checked&&($("#company_name").val($("#first_name").val()+" "+$("#last_name").val()),addRemoveLabourFromTermsAndConditions($("#order_business_type_description").val()))}),$("#acknowledgement").change(function(){this.checked?($("#email").attr("validation_required","req"),$("#email").addClass("wrong-input"),$("#email").addClass("dynamic-border-input")):($("#email").attr("validation_required",""),$("#email").removeClass("wrong-input"),$("#email").removeClass("dynamic-border-input")),ReScanForValidations(),resetHeadings()}),$("#order_business_types_id").change(function(){$("#order_business_type_description").val($(this).find("option[value="+$(this).val()+"]").text()),"Others"==$("#order_business_type_description").val()?($("#order_business_type_description").addClass("wrong-input"),$("#order_business_type_description").val(""),$("#business_type_description_div").show(),$("#order_business_type_description").attr("validation_required","req")):(""!=$(this).val()?$("#order_business_type_description").removeClass("wrong-input"):$("#order_business_type_description").addClass("wrong-input"),$("#business_type_description_div").hide(),$("#order_business_type_description").attr("validation_required","")),"Household Items"==$("#order_business_type_description").val()?$("#order_labourers").addClass("wrong-input"):$("#order_labourers").removeClass("wrong-input"),addRemoveLabourFromTermsAndConditions($("#order_business_type_description").val()),resetHeadings(),highlightTermsAndConditions(),ReScanForValidations()}),$("#place_order,#edit_order_status").on("keyup change","input, select, textarea, radio",function(){setTimeout(function(){updatePreviewAndBook()},300)}),$("body").on("click",".preview-heading",function(){var e="#"+$(this).attr("data-shortcut-to");$("html, body").animate({scrollTop:$(e).offset().top},500)}),$(".place-order-section-heading").click(function(){$(this).siblings(".content-common").toggle(),"location-heading"==$(this).attr("id")&&("undefined"!=typeof directionsDisplay.getDirections()&&google.maps.event.addListenerOnce(map,"resize",function(){try{this.fitBounds(directionsDisplay.getDirections().routes[0].bounds)}catch(e){}}),google.maps.event.trigger(map,"resize"),map.setZoom(map.getZoom()),"undefined"==typeof directionsDisplay.getDirections()&&$("#order_geo_region_id").change())}),initialize_place_order();var counter=parseInt(document.getElementById("waypoint_count").value);if(!document.getElementById("waypoint_"+counter+"_address_landmark"))for(var i=0;i<document.getElementById("waypoint_count").value;++i)add_waypoint_div(i+1,"waypoints"),document.getElementById("waypoint_"+(i+1)+"_address_landmark").value=document.getElementById("waypt_"+i).value,document.getElementById("waypoint_"+(i+1)+"_address_lat").value=document.getElementById("waypt_lat_"+i).value,document.getElementById("waypoint_"+(i+1)+"_address_long").value=document.getElementById("waypt_long_"+i).value;document.getElementById("order_geo_region_id").value&&$("#order_geo_region_id").change()});var limit=8,waypts=[],pickup_restricted_pins={},vehicle_pincode_restrictions={};